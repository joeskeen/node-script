#!/usr/bin/env node
function setupOptions(r){return r.usage("$0 script_path [script_args]").demand(1).option("verbose",{alias:"v","boolean":!0,description:"enable verbose logging"})}function log(){for(var r=[],s=0;s<arguments.length;s++)r[s-0]=arguments[s];args.verbose&&console.log.apply(this,r)}var yargs=require("yargs"),path=require("path"),childProcess=require("child_process"),scriptFile=setupOptions(yargs).argv._[0],scriptFileArgIndex=process.argv.indexOf(scriptFile),nodeScriptArgs=process.argv.slice(0,scriptFileArgIndex),scriptArgs=process.argv.slice(scriptFileArgIndex),args=setupOptions(yargs(nodeScriptArgs)).argv;global.script=function(r){if(log("script with config: ",r),r&&r.dependencies){var s=r.dependencies,e=Object.keys(s).map(function(r){return r+"@"+s[r]});childProcess.execSync("npm install "+e.join(" "),{stdio:args.verbose?[0,1,2]:void 0}),log(e)}},log("process.argv",process.argv),log("nodeScriptArgs",nodeScriptArgs),log("scriptArgs",scriptArgs),process.argv.length=0,scriptArgs.forEach(function(r){return process.argv.push(r)});var scriptPath=path.resolve(process.cwd(),scriptFile);log("running script "+scriptPath+"..."),require(scriptPath);